<?php
############################################################################
#	getEventPilots.class
#
#	Tim Traver
#	3/12/2017
#	class to extend API class to get pilots info for an event
#
############################################################################
#
include_library('event.class');

class getEventPilots {
	public $event_id;
	public $api;
	
	public function __construct($api){
		$this->api = $api;
		$this->set_function_parameters();
	}
	
	public function set_function_parameters(){
		# This is where we set the mandatory fields
		$this->api->function_parameters = array(
			array("name" => "event_id", "type" => "string", "description" => "Event ID", "mandatory" => 1)
		);
		$this->api->function_output_description = 
			"One Per line of the following\nPilot_id, Pilot_Bib, First_Name, Last_Name, Pilot_Class, AMA, FAI, FAI License, Team_Name";
	}

	public function process_request(){
		global $smarty;
		
		# This is the method where we process the request
		$this->event_id = $this->api->input_variables['event_id'];
		start_smarty();

		$event = new Event($this->event_id);
		$fs = $this->api->field_separator;

		$smarty->assign("event",$event);
		$smarty->assign("fs",$fs);		
		
		$template = "api/event_pilots.tpl";
	
		# Get the export content
		$content_template = find_template($template);
		$content = $smarty->fetch($content_template);		
		
		return $content;

	}

}

?>